#!/usr/bin/env bash
set -euo pipefail

usage() {
  cat <<'EOF'
git-wt - worktree helper toolkit

Usage:
  git-wt <command> [args...]

Commands:
  init      Clone a repo into a container (main/ + wt/)
  migrate   Convert an existing clean repo into a container
  pr        PR worktree management (checkout/update)
  add       Add a worktree for a branch (use -b to create)
  path      Print the worktree path for a branch
  list      List worktrees in the container
  status    Summarize status across worktrees
  open      Open a worktree using configured command
  config    Manage git-wt config (show/get/set)
  sync      Fetch origin and fast-forward main
  clean     Remove merged worktrees safely
  remove    Remove a worktree safely (optional branch delete)

Run:
  git-wt <command> --help
EOF
}

cmd="${1:-}"
shift || true

if [[ -z "$cmd" || "$cmd" == "-h" || "$cmd" == "--help" ]]; then
  usage
  exit 0
fi

# Resolve libexec next to this script, regardless of how dfm links it.
self_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
libexec="${self_dir}/../libexec/git-wt"
libexec="$(cd "$libexec" && pwd)"

sub="${libexec}/${cmd}"
if [[ ! -x "$sub" ]]; then
  echo "git-wt: unknown command: $cmd" >&2
  echo >&2
  usage >&2
  exit 2
fi

exec "$sub" "$@"
